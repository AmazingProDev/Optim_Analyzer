<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Cracker Pro - Nemo Visualizer</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì°</text></svg>">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div id="app">
        <header>
            <div class="logo">Log Cracker Pro</div>
            <div class="controls">
                <input type="file" id="fileInput" accept=".nmf">
                <label for="fileInput" class="btn">Load NMF</label>

                <input type="file" id="siteInput" accept=".xlsx, .xls, .csv" style="display:none;">
                <label for="siteInput" class="btn" style="background:#2563eb;">Import Sites</label>

                <button id="siteSettingsBtn" class="btn" style="background:#4b5563;">‚öôÔ∏è</button>

                <span id="fileStatus">No file loaded</span>
            </div>

            <!-- Site Settings Panel -->
            <div id="siteSettingsPanel"
                style="display:none; position:absolute; top:60px; right:20px; background:#1e1e1e; border:1px solid #444; padding:15px; border-radius:6px; z-index:2000; box-shadow:0 4px 12px rgba(0,0,0,0.5); width:250px;">
                <h4 style="margin-top:0; color:#fff; border-bottom:1px solid #333; padding-bottom:8px;">Site Settings
                </h4>

                <div style="margin-bottom:10px;">
                    <label style="display:block; color:#aaa; font-size:12px; margin-bottom:4px;">Range (m): <span
                            id="valRange">200</span></label>
                    <input type="range" id="rangeSiteDist" min="50" max="3000" step="50" value="200"
                        style="width:100%;">
                </div>

                <div style="margin-bottom:10px;">
                    <label style="display:block; color:#aaa; font-size:12px; margin-bottom:4px;">Beamwidth (¬∞): <span
                            id="valBeam">60</span></label>
                    <input type="range" id="rangeIconBeam" min="10" max="180" step="5" value="60" style="width:100%;">
                </div>

                <div style="margin-bottom:10px;">
                    <label style="display:block; color:#aaa; font-size:12px; margin-bottom:4px;">Opacity: <span
                            id="valOpacity">0.6</span></label>
                    <input type="range" id="rangeSiteOpacity" min="0.1" max="1" step="0.1" value="0.6"
                        style="width:100%;">
                </div>

                <div style="margin-bottom:10px;">
                    <label style="display:block; color:#aaa; font-size:12px; margin-bottom:4px;">Color Override</label>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="color" id="pickerSiteColor" value="#3b82f6"
                            style="border:none; width:30px; height:30px; cursor:pointer;">
                        <label style="font-size:11px; color:#888;"><input type="checkbox" id="checkSiteColorOverride">
                            Apply</label>
                    </div>
                </div>

                <div style="margin-bottom:10px;">
                    <label style="display:block; color:#aaa; font-size:12px; margin-bottom:4px;">Labels</label>
                    <div style="display:flex; flex-direction:column; gap:5px;">
                        <label style="font-size:11px; color:#888;"><input type="checkbox" id="checkShowSiteNames"> Show
                            Site Names</label>
                        <label style="font-size:11px; color:#888;"><input type="checkbox" id="checkShowCellNames"> Show
                            Cell Names</label>
                    </div>
                </div>

                <div style="text-align:right;">
                    <button id="closeSiteSettings"
                        style="background:#555; color:white; border:none; padding:4px 10px; cursor:pointer; font-size:11px; border-radius:3px;">Close</button>
                </div>
            </div>
            <div class="stats" id="statsDisplay">
                <!-- Stats will go here -->
            </div>
        </header>

        <main>
            <div id="logs-sidebar">
                <h3>Loaded Logs</h3>
                <div id="logsList">
                    <div class="empty-state">No logs loaded</div>
                </div>
            </div>

            <div id="center-pane"
                style="flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden;">
                <div id="map" style="flex: 1;"></div>

                <!-- Bottom Panel for Docked Views -->
                <div id="bottomPanel"
                    style="height: 0; display: none; flex-direction: column; background: #1e1e1e; border-top: 1px solid #444;">
                    <div id="bottomResizer"
                        style="height: 5px; background: #333; cursor: ns-resize; flex-shrink: 0; display: flex; justify-content: center; align-items: center;">
                        <div style="width: 30px; height: 2px; background: #555; border-radius: 1px;"></div>
                    </div>
                    <div id="bottomContent" style="flex: 1; display: flex; overflow: hidden;">
                        <!-- Docked Content Will Go Here -->
                        <div id="dockedChart"
                            style="flex: 1; display: none; border-right: 1px solid #333; position: relative;"></div>
                        <div id="dockedSignaling" style="flex: 1; display: none; position: relative;"></div>
                    </div>
                </div>
            </div>

            <div id="sidebar" class="hidden">
                <h3>Point Details</h3>
                <div id="pointDetails"></div>
            </div>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Signaling Modal -->
    <div id="signalingModal" class="modal">
        <div class="modal-content"
            style="width:80%; max-width:900px; background:#1e1e1e; border:1px solid #444; height:80vh; display:flex; flex-direction:column; padding:0;">
            <div class="modal-header"
                style="padding:15px; border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:15px;">
                    <h3 id="signalingModalTitle" style="margin:0; color:#ddd;">Signaling Data</h3>
                    <select id="signalingFilter" onchange="filterSignaling()"
                        style="background:#333; color:#eee; border:1px solid #555; padding:4px 8px; border-radius:4px; font-size:12px;">
                        <option value="ALL">All Types</option>
                        <option value="RRC">RRC Only</option>
                        <option value="L3">L3 Only</option>
                    </select>
                </div>
                <span class="close" onclick="closeSignalingModal()"
                    style="color:#aaa; cursor:pointer; font-size:24px;">&times;</span>
            </div>
            <div class="modal-body" style="flex:1; overflow-y:auto; padding:0;">
                <table class="data-table" style="width:100%; border-collapse:collapse; font-size:12px;">
                    <thead style="position:sticky; top:0; background:#252525; z-index:10;">
                        <tr>
                            <th style="padding:10px; text-align:left; color:#aaa; border-bottom:1px solid #444;">Time
                            </th>
                            <th style="padding:10px; text-align:left; color:#aaa; border-bottom:1px solid #444;">Type
                            </th>
                            <th style="padding:10px; text-align:left; color:#aaa; border-bottom:1px solid #444;">
                                Direction</th>
                            <th style="padding:10px; text-align:left; color:#aaa; border-bottom:1px solid #444;">Message
                            </th>
                            <th style="padding:10px; text-align:left; color:#aaa; border-bottom:1px solid #444;">Action
                            </th>
                        </tr>
                    </thead>
                    <tbody id="signalingTableBody">
                        <!-- Data rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="map_renderer.js?v=23"></script>
    <script src="parser.js?v=23"></script>
    <script src="app.js?v=27"></script>
</body>

</html>